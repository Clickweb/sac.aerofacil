<?xml version="1.0" encoding="UTF-8"?>
<rules xmlns="http://namespaces.plone.org/diazo"
       xmlns:css="http://namespaces.plone.org/diazo/css"
       xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <theme href="theme.html" css:if-content="#visual-portal-wrapper" />
  <xsl:output method="html" />

  <!-- Head -->
  <copy attributes="lang dir" css:content="html" css:theme="html" />
  <!-- TODO: Descartar linhas comentadas quando resolver bug do registro dos resources: http://stackoverflow.com/questions/18877354/how-can-i-make-plone-portal-registries-find-and-cook-new-style-static-resources -->
  <!--before css:content="head base, head meta, head link, head style, head script" css:theme-children="head" /-->
  <!--replace css:content="head title" css:theme="head title" /-->
  <replace css:content-children="head" css:theme-children="head" />

  <!-- Top -->
  <copy attributes="*" css:content="body" css:theme="body" />
  <before css:content="#portal-header > p.hiddenStructure:first-child" css:theme-children="body" />
  <before css:content="#portal-personaltools-wrapper" css:theme-children=".barra-topo .centraliza" css:if-content="#user-name" />
  <copy attributes="href title" css:content="#portal-logo" css:theme=".topo h1 a" />
  <replace css:content=".menu" css:theme=".menu" />

  <!-- Column Content -->
  <!-- TODO: Copiar classe do conteudo -->
  <!-- EBREHAULT -->
  <xsl:template match="//*[starts-with(@class, 'conteudo')]">
    <xsl:copy>
        <xsl:attribute name="class"><xsl:value-of select="$conteudo_klass" /></xsl:attribute>
        <xsl:apply-templates select="@*[not(name()='class')]|node()" />
    </xsl:copy>
  </xsl:template>
  <!--Identity template copies content forward -->
  <xsl:template match="@*|node()">
      <xsl:copy>
          <xsl:apply-templates select="@*|node()"/>
      </xsl:copy>
  </xsl:template>
  <!-- GLICK -->
  <!-- <before css:theme-children=".conteudo">
      <xsl:attribute name="class"><xsl:value-of select="$conteudo_klass" /></xsl:attribute>
  </before> -->
  <!-- LAURENCE -->
  <!-- <replace content="/html/body/div[2]/@class">
    <xsl:attribute name="class"><xsl:value-of select="."/> $conteudo_klass</xsl:attribute>
  </replace> -->
  <!-- D6 01 -->  
  <!-- <replace attributes="class" css:theme=".conteudo">$conteudo_klass</replace> -->
  <!-- D6 02 -->  
  <!-- <replace css:theme=".conteudo">
      <xsl:attribute name="class">$conteudo_klass</xsl:attribute>
      <xsl:value-of select="."/> 
  </replace> -->
  <!-- D6 03 -->  
  <!-- <xsl:template match="//div[contains(concat(' ', normalize-space(@class), ' '), ' conteudo ')]">
      <xsl:attribute name="class">
          <xsl:value-of select="substring((body/@class), 'section-', 0)" />
      </xsl:attribute>
  </xsl:template> -->
  <replace css:content-children="#portal-column-content" css:theme-children=".conteudo" css:if-content=".section-guia-do-passageiro" />
  <replace css:theme-children=".conteudo"
      css:if-not-content=".section-home.template-document_view, .section-home.template-folder_listing">
      <div class="centraliza">
        <div class="miolo">
          <xsl:copy-of css:select="#portal-column-content > *" />
        </div>
      </div>
  </replace>
  <before css:content-children="#portal-column-one" css:theme-children=".conteudo" css:if-content="" />
  <after css:content-children="#portal-column-two" css:theme-children=".conteudo" css:if-content="" />
  <before css:content="div[class*=share], .outras-noticias" css:theme="#rodape" />

  <!-- Home -->
  <before css:content="#edit-bar" css:theme="#topo" css:if-content=".section-home" />
  <replace css:content=".destaques" css:theme-children=".destaques" css:if-content="" />
  <replace css:content=".select-aeroporto-home" css:theme=".select-aeroporto-home" css:if-content="" />
  <replace css:content=".noticias" css:theme-children=".noticias" css:if-content="" />
  
</rules>